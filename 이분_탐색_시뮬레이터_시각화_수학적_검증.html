<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>이분 탐색 시뮬레이터 (Vanilla JS)</title>
<style>
  :root{
    --bg:#0b0c0f; --card:#121318; --muted:#1a1c22; --border:#2a2d36;
    --fg:#e7eaf1; --fg-dim:#a9afbf;
    --sky-bg:#e0f2fe; --sky-fg:#075985;
    --purple-bg:#f3e8ff; --purple-fg:#6b21a8;
    --amber-bg:#fef3c7; --amber-fg:#92400e;
    --emerald-bg:#d1fae5; --emerald-fg:#065f46;
    --red-bg:#fee2e2; --red-fg:#991b1b;
  }
  * { box-sizing: border-box; }
  body {
    margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    background: var(--bg); color: var(--fg);
  }
  .container { max-width: 1000px; margin: 24px auto; padding: 0 16px; }
  header { display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
  .title { font-weight:600; font-size:20px; letter-spacing:.2px; }
  .subtitle { color:var(--fg-dim); font-size:12px; margin-top:4px; }
  .pill{ font-size:12px; padding:4px 10px; border-radius:999px; }
  .pill-muted{ background:#1f2430; color:#aeb6c8; }
  .pill-emerald{ background:var(--emerald-bg); color:var(--emerald-fg); }
  .pill-amber{ background:var(--amber-bg); color:var(--amber-fg); }
  .pill-red{ background:var(--red-bg); color:var(--red-fg); }
  .card{ background:var(--card); border:1px solid var(--border); border-radius:12px; box-shadow: 0 1px 0 rgba(0,0,0,.4); }
  .card .content{ padding:16px; }
  .grid{ display:grid; gap:12px; }
  .grid-4{ grid-template-columns: repeat(4,minmax(0,1fr)); }
  .grid-2{ grid-template-columns: repeat(2,minmax(0,1fr)); }
  .field label{ display:block; font-size:12px; color:var(--fg-dim); margin-bottom:6px; }
  .select, .input{
    width:100%; height:36px; background:var(--muted); border:1px solid var(--border); color:var(--fg);
    border-radius:8px; padding:0 10px; font-size:14px; outline:none;
  }
  .btn{
    height:32px; padding:0 10px; border-radius:8px; border:1px solid var(--border);
    background:#1f2430; color:#dce3f5; font-size:13px; cursor:pointer;
  }
  .btn:hover{ filter:brightness(1.05); }
  .btn-outline{ background:transparent; }
  .btn-danger{ background:#3a1d1d; border-color:#713131; }
  .row{ display:flex; flex-wrap:wrap; gap:8px; }
  .legend { display:flex; align-items:center; gap:8px; color:var(--fg-dim); font-size:12px; }
  .dot{ width:8px; height:8px; border-radius:50%; display:inline-block; }
  .dot-sky{ background:#38bdf8; }
  .dot-purple{ background:#a78bfa; }
  .dot-amber{ background:#f59e0b; }
  .boxes-wrap{ overflow-x:auto; padding:8px 8px 4px; }
  .boxes{ display:flex; align-items:flex-start; gap:8px; min-width:560px; padding:0 8px 4px; }
  .box-col{ display:flex; flex-direction:column; align-items:center; gap:4px; }
  .box{
    border:1px solid var(--border); width:36px; height:36px; display:flex; align-items:center; justify-content:center;
    border-radius:10px; position:relative; background:#171922; box-shadow: 0 1px 0 rgba(0,0,0,.35);
    font-size:13px; padding-top:2px;
  }
  .box.inrange{ background:#202430; }
  .ring-sky{ outline:2px solid #38bdf8; outline-offset:0; }
  .ring-purple{ outline:2px solid #a78bfa; outline-offset:0; }
  .ring-amber{ outline:2px solid #f59e0b; outline-offset:0; }
  .ins-tip{
    position:absolute; top:-6px; font-size:10px; padding:1px 4px; border-radius:999px;
    background: var(--amber-bg); color: var(--amber-fg); box-shadow:0 1px 0 rgba(0,0,0,.25);
  }
  .index { font-size:10px; color:var(--fg-dim); }
  .hint-end{ background: var(--amber-bg); color: var(--amber-fg); }
  .status-line{ display:flex; align-items:center; gap:12px; color:var(--fg-dim); font-size:12px; }
  .spacer{ flex:1; }
  .table{ border:1px solid var(--border); border-radius:10px; overflow:hidden; }
  .thead{ background:#1a1e27; display:grid; grid-template-columns: repeat(6, 1fr); padding:8px 12px; font-weight:600; font-size:12px;}
  .tbody{ max-height:224px; overflow:auto; }
  .tr{ display:grid; grid-template-columns: repeat(6, 1fr); padding:8px 12px; font-size:12px; border-top:1px solid var(--border); }
  .tr.error{ background:#2a1717; }
  .tr.loop{ background:#2a2212; }
  .tr.found{ background:#16241c; }
  .combo table{ width:100%; border-collapse:collapse; }
  .combo th, .combo td{ padding:8px; border-bottom:1px solid var(--border); text-align:left; font-size:12px; white-space:nowrap; }
  .combo thead{ background:#1a1e27; }
  .badge{ font-size:11px; padding:2px 8px; border-radius:999px; display:inline-block; }
  .badge-ok{ background:var(--emerald-bg); color:var(--emerald-fg); }
  .badge-ins{ background:var(--sky-bg); color:var(--sky-fg); }
  .badge-loop{ background:var(--amber-bg); color:var(--amber-fg); }
  .badge-err{ background:var(--red-bg); color:var(--red-fg); }
  .tests .row{ border-top:1px solid var(--border); padding:8px 12px; display:flex; align-items:center; gap:12px; }
  .ok{ color:#34d399; } .fail{ color:#ef4444; }
</style>
</head>
<body>
  <div class="container">
    <header>
      <div>
        <div class="title">이분 탐색 시뮬레이터</div>
        <div class="subtitle">범위·st·en·종료 2×2×2×2 조합 — 오류/루프/삽입점까지 한눈에.</div>
      </div>
      <span id="status-pill" class="pill pill-muted">⏳ 진행 중</span>
    </header>

    <!-- Controls -->
    <div class="card">
      <div class="content grid">
        <div class="grid grid-4">
          <div class="field">
            <label>탐색 범위</label>
            <select id="bounds" class="select">
              <option value="0..n">[0, n)</option>
              <option value="0..n-1">[0, n-1]</option>
            </select>
          </div>
          <div class="field">
            <label>st 갱신</label>
            <select id="ltUpdateSt" class="select">
              <option value="mid+1">st = mid+1</option>
              <option value="mid">st = mid</option>
            </select>
          </div>
          <div class="field">
            <label>en 갱신</label>
            <select id="gtUpdateEn" class="select">
              <option value="mid">en = mid</option>
              <option value="mid-1">en = mid-1</option>
            </select>
          </div>
          <div class="field">
            <label>종료 조건</label>
            <select id="terminateToken" class="select">
              <option value="st_ge_en">st ≥ en</option>
              <option value="st_gt_en">st &gt; en</option>
            </select>
          </div>
        </div>

        <div class="grid grid-2">
          <div class="field">
            <label>배열</label>
            <input id="arrayText" class="input" value="1,2,3,5,5,7,9,12,12,13,17" placeholder="1,2,3,5,5,7,9" />
          </div>
          <div class="field">
            <label>찾을 값</label>
            <input id="target" class="input" type="number" value="12" />
          </div>
        </div>

        <div class="row">
          <button id="btnStep" class="btn">▶ 한 칸</button>
          <button id="btnAuto" class="btn btn-danger">⏯ 자동 실행</button>
          <button id="btnReset" class="btn btn-outline">↺ 리셋</button>
        </div>
      </div>
    </div>

    <!-- Visualization -->
    <div class="card" style="margin-top:12px;">
      <div class="content grid">
        <div class="legend">
          <span class="pill" style="background:var(--sky-bg); color:var(--sky-fg)">st</span>
          <span class="pill" style="background:var(--purple-bg); color:var(--purple-fg)">mid</span>
          <span class="pill" style="background:var(--amber-bg); color:var(--amber-fg)">en</span>
          <span id="candidate" style="color:var(--fg-dim)">후보: [st, en)</span>
        </div>

        <div class="boxes-wrap">
          <div id="boxes" class="boxes"></div>
        </div>

        <div class="status-line">
          <div><span class="dot dot-sky"></span> st=<span id="stVal">0</span></div>
          <div><span class="dot dot-purple"></span> mid=<span id="midVal">0</span></div>
          <div><span class="dot dot-amber"></span> en=<span id="enVal">0</span></div>
          <div class="spacer"></div>
          <div>step <span id="stepVal">0</span></div>
        </div>

        <!-- History -->
        <div class="table">
          <div class="thead"><div>step</div><div>st</div><div>mid</div><div>en</div><div>cmp</div><div>note</div></div>
          <div id="tbody" class="tbody"></div>
        </div>
      </div>
    </div>

    <!-- 16 combos & tests -->
    <div class="card" style="margin-top:12px;">
      <div class="content grid">
        <div style="display:flex; justify-content:space-between; align-items:center;">
          <div class="subtitle">현재 배열/타깃으로 모든 조합을 실행해 <b>정상/루프/오류</b>를 요약합니다.</div>
          <div class="row">
            <button id="btnCombos" class="btn">전체 조합</button>
            <button id="btnTests" class="btn btn-outline">내장 테스트</button>
          </div>
        </div>

        <div id="comboWrap" class="combo" style="display:none;">
          <div class="table" style="overflow:auto;">
            <table>
              <thead>
                <tr><th>범위</th><th>st</th><th>en</th><th>종료</th><th>결과</th></tr>
              </thead>
              <tbody id="comboBody"></tbody>
            </table>
          </div>
        </div>

        <div id="testsWrap" class="tests" style="display:none;">
          <div class="subtitle" style="margin-bottom:6px;">내장 테스트 결과</div>
          <div id="testsBody" class="table"></div>
        </div>
      </div>
    </div>
  </div>

<script>
/* =============================
 * Helpers
 * ===========================*/
const clamp = (x,a,b)=>Math.max(a,Math.min(b,x));
function parseArray(text){
  if(!text.trim()) return [];
  return text.replace(/\s+/g," ").replace(/，/g, ",").split(/[,\s]+/).map(Number).filter(v=>!Number.isNaN(v));
}

/* =============================
 * Diagnostics & Invariants
 * ===========================*/
function checkInvariant(bounds, st, en, n){
  if(bounds==="0..n"){
    const ok = 0<=st && st<=en && en<=n;
    return {ok, msg: ok?"[st, en) 유지":"불변식 위반: 0 ≤ st ≤ en ≤ n 깨짐"};
  }
  const ok = 0<=st && st<=en && en<n;
  return {ok, msg: ok?"[st, en] 유지":"불변식 위반: 0 ≤ st ≤ en < n 깨짐"};
}
function midRangeOk(bounds, st, en, mid){
  return bounds==="0..n" ? (st<=mid && mid<=en-1) : (st<=mid && mid<=en);
}

/* =============================
 * Pure simulator (for combos & tests)
 * ===========================*/
function simulateOnce({ arr, t, bounds, ltUpdateSt, gtUpdateEn, terminateToken, maxSteps=10000 }){
  const n = arr.length;
  let st = 0;
  let en = bounds==="0..n" ? n : n-1;
  let steps = 0;
  const seen = new Set();
  const term = (a,b)=> terminateToken==="st_ge_en" ? a>=b : a>b;
  const calcMid = (a,b)=> Math.floor((a+b)/2);

  while(steps++ < maxSteps){
    const inv = checkInvariant(bounds, st, en, n);
    if(!inv.ok) return {status:"error", reason:inv.msg, steps, st, en};
    const key = `${st}|${en}`;
    if(seen.has(key)) return {status:"loop", reason:"같은 (st,en) 재방문", steps, st, en};
    seen.add(key);

    if(term(st,en)){
      if(bounds==="0..n"){
        const idx = st;
        const found = idx>=0 && idx<n && arr[idx]===t;
        return {status:"ok", idx, found, steps};
      }else{
        return {status:"ok", idx:-1, found:false, steps};
      }
    }

    const mid = calcMid(st,en);
    if(!midRangeOk(bounds, st, en, mid) || !(0<=mid && mid<n)){
      return {status:"error", reason:"mid 범위 오류", steps, st, en, mid};
    }

    const v = arr[mid];
    if(v < t){
      const newSt = ltUpdateSt==="mid" ? mid : mid+1;
      if(newSt===st) return {status:"loop", reason:"진전 없음: st 유지", steps, st, en, mid};
      st = newSt; continue;
    }
    if(v > t){
      const newEn = gtUpdateEn==="mid" ? mid : mid-1;
      if(newEn===en) return {status:"loop", reason:"진전 없음: en 유지", steps, st, en, mid};
      en = newEn; continue;
    }
    return {status:"ok", idx:mid, found:true, steps};
  }
  return {status:"error", reason:"스텝 한도 초과", steps};
}

/* =============================
 * UI State
 * ===========================*/
const el = id => document.getElementById(id);
const $bounds = el("bounds");
const $lt = el("ltUpdateSt");
const $gt = el("gtUpdateEn");
const $term = el("terminateToken");
const $arrayText = el("arrayText");
const $target = el("target");

const $stVal = el("stVal"), $midVal = el("midVal"), $enVal = el("enVal"), $stepVal = el("stepVal");
const $candidate = el("candidate");
const $boxes = el("boxes");
const $tbody = el("tbody");
const $statusPill = el("status-pill");

const $btnStep = el("btnStep");
const $btnAuto = el("btnAuto");
const $btnReset = el("btnReset");

const $btnCombos = el("btnCombos");
const $comboWrap = el("comboWrap");
const $comboBody = el("comboBody");

const $btnTests = el("btnTests");
const $testsWrap = el("testsWrap");
const $testsBody = el("testsBody");

let arr = parseArray($arrayText.value);
let t = Number($target.value);
let n = arr.length;

let bounds = $bounds.value;               // "0..n" | "0..n-1"
let ltUpdateSt = $lt.value;               // "mid" | "mid+1"
let gtUpdateEn = $gt.value;               // "mid" | "mid-1"
let terminateToken = $term.value;         // "st_ge_en" | "st_gt_en"

let st=0, en=0, mid=0, step=0;
let foundIndex = null;     // null 진행중, >=0 성공, -1 실패
let insertionIdx = null;   // [0,n) 실패 시 삽입점
let history = [];          // {step, st, mid, en, cmp, note, kind}
let diag = { loop:false, error:null, invariantOk:true };
let visited = new Set();
let autorun = false;
let speedMs = 600;
let timer = null;

/* =============================
 * Renderers
 * ===========================*/
function setStatusPill(){
  let text, cls="pill ";
  if(diag.error){ text = `❌ 오류: ${diag.error}`; cls += "pill-red"; }
  else if(diag.loop){ text = "⚠️ 무한 루프 감지"; cls += "pill-amber"; }
  else if(foundIndex===null){ text = "⏳ 진행 중"; cls += "pill-muted"; }
  else if(foundIndex>=0){ text = `✅ index ${foundIndex}`; cls += "pill-emerald"; }
  else if(bounds==="0..n" && insertionIdx!==null){ text = `❌ 없음 (삽입점=${insertionIdx})`; cls += "pill-muted"; }
  else { text = "❌ 없음"; cls += "pill-muted"; }
  $statusPill.className = cls;
  $statusPill.textContent = text;
}

function renderBoxes(){
  $boxes.innerHTML = "";
  const isHalfOpen = bounds==="0..n";
  const inRange = (i)=> isHalfOpen ? (i>=st && i<en) : (i>=st && i<=en);
  for(let i=0;i<n;i++){
    const col = document.createElement("div");
    col.className="box-col";
    const box = document.createElement("div");
    box.className="box"+(inRange(i)?" inrange":"");
    const isSt = i===st;
    const isEn = i===en;
    const isMid = i===mid;
    if(isMid) box.classList.add("ring-purple");
    else if(isSt) box.classList.add("ring-sky");
    else if(isEn) box.classList.add("ring-amber");

    box.title = `idx ${i} / val ${arr[i]}`;
    box.textContent = arr[i];

    const isIns = (bounds==="0..n" && insertionIdx!==null && insertionIdx===i && foundIndex===-1);
    if(isIns){
      const tip = document.createElement("span");
      tip.className="ins-tip";
      tip.textContent = "삽입점";
      box.appendChild(tip);
    }
    col.appendChild(box);

    const idx = document.createElement("div");
    idx.className="index"; idx.textContent = i;
    col.appendChild(idx);
    $boxes.appendChild(col);
  }
  // 삽입점이 n(끝)인 경우 시각 힌트
  if(bounds==="0..n" && insertionIdx===n && foundIndex===-1){
    const col = document.createElement("div");
    col.className="box-col";
    const box = document.createElement("div");
    box.className="box hint-end"; box.textContent="∅";
    col.appendChild(box);
    const idx = document.createElement("div");
    idx.className="index"; idx.textContent="삽입점=n";
    col.appendChild(idx);
    $boxes.appendChild(col);
  }
}

function renderHeaderSmall(){
  $stVal.textContent = st;
  $midVal.textContent = mid;
  $enVal.textContent = en;
  $stepVal.textContent = step;
  $candidate.textContent = "후보: " + (bounds==="0..n" ? "[st, en)" : "[st, en]");
}

function renderHistory(){
  $tbody.innerHTML = "";
  const rev = [...history].reverse();
  for(const h of rev){
    const row = document.createElement("div");
    row.className = "tr" + (h.kind==="error"?" error": h.kind==="loop"?" loop": h.kind==="found"?" found":"");
    row.innerHTML = `<div>${h.step}</div><div>${h.st}</div><div>${h.mid}</div><div>${h.en}</div><div>${h.cmp}</div><div title="${h.note}">${h.note}</div>`;
    $tbody.appendChild(row);
  }
}

function renderAll(){
  setStatusPill();
  renderBoxes();
  renderHeaderSmall();
  renderHistory();
}

/* =============================
 * Engine
 * ===========================*/
const term = (a,b)=> terminateToken==="st_ge_en" ? a>=b : a>b;
const calcMid = (a,b)=> Math.floor((a+b)/2);

function resetAll(){
  n = arr.length;
  if(bounds==="0..n"){ st=0; en=n; } else { st=0; en=n-1; }
  mid = Math.floor((0 + (bounds==="0..n" ? n : n-1))/2);
  step=0;
  foundIndex=null; insertionIdx=null;
  history=[]; diag={ loop:false, error:null, invariantOk:true };
  visited=new Set();
  autorun=false; clearTimer();
  renderAll();
}

function clearTimer(){ if(timer){ clearInterval(timer); timer=null; } }
function startTimer(){ clearTimer(); timer = setInterval(()=> stepOnce(), clamp(speedMs, 120, 2000)); }

function pushHistory(obj){ history.push(obj); }

function stepOnce(){
  if(arr.length===0 || diag.error){ return; }

  // Invariant at loop start
  const inv = checkInvariant(bounds, st, en, n);
  if(!inv.ok){
    diag.error = inv.msg; diag.invariantOk=false;
    pushHistory({ step: step+1, st, mid, en, cmp:"!", note:inv.msg, kind:"error" });
    foundIndex = -1; autorun=false; clearTimer(); renderAll(); return;
  }

  const key = `${st}|${en}`;
  if(visited.has(key)){
    diag.loop = true;
    pushHistory({ step: step+1, st, mid, en, cmp:"↻", note:"같은 (st,en) 재방문: 무한 루프 가능", kind:"loop" });
    autorun=false; clearTimer(); renderAll(); return;
  }
  visited.add(key);

  if(term(st,en)){
    if(bounds==="0..n"){
      const ok = st>=0 && st<n && arr[st]===t;
      insertionIdx = st;
      foundIndex = ok ? st : -1;
      pushHistory({ step: step+1, st, mid, en, cmp:"·", note: ok?"종료: st ≥ en → 성공" : `종료: st ≥ en → 실패(삽입점=${st})`, kind: ok?"found":"stop" });
    }else{
      insertionIdx = null; foundIndex = -1;
      pushHistory({ step: step+1, st, mid, en, cmp:"·", note:"종료: st > en", kind:"stop" });
    }
    autorun=false; clearTimer(); renderAll(); return;
  }

  const m = calcMid(st,en);
  mid = m;

  if(!midRangeOk(bounds, st, en, m) || !(0<=m && m<n)){
    const msg = "mid 범위 오류";
    diag.error=msg;
    pushHistory({ step: step+1, st, mid:m, en, cmp:"!", note:msg, kind:"error" });
    foundIndex=-1; autorun=false; clearTimer(); renderAll(); return;
  }

  const v = arr[m];
  if(v < t){
    const newSt = ltUpdateSt==="mid" ? m : m+1;
    const noProgress = newSt===st;
    const note = `v < target → st = ${ltUpdateSt}${noProgress?" (진전 없음)":""}`;
    pushHistory({ step: step+1, st, mid:m, en, cmp:"<", note, kind: noProgress?"loop":"step" });
    if(noProgress){ diag.loop=true; autorun=false; clearTimer(); renderAll(); return; }
    st = newSt;
  }else if(v > t){
    const newEn = gtUpdateEn==="mid" ? m : m-1;
    const noProgress = newEn===en;
    const note = `v > target → en = ${gtUpdateEn}${noProgress?" (진전 없음)":""}`;
    pushHistory({ step: step+1, st, mid:m, en, cmp:">", note, kind: noProgress?"loop":"step" });
    if(noProgress){ diag.loop=true; autorun=false; clearTimer(); renderAll(); return; }
    en = newEn;
  }else{
    pushHistory({ step: step+1, st, mid:m, en, cmp:"=", note:"v == target → return mid", kind:"found" });
    foundIndex = m;
    insertionIdx = (bounds==="0..n") ? m : null;
    autorun=false; clearTimer(); renderAll(); return;
  }
  step += 1;
  renderAll();
}

/* =============================
 * 16-combo & Tests
 * ===========================*/
function runAll16(){
  const boundsOpts = ["0..n","0..n-1"];
  const stOpts = ["mid","mid+1"];
  const enOpts = ["mid","mid-1"];
  const termOpts = ["st_ge_en","st_gt_en"];
  const res=[];
  const curArr = parseArray($arrayText.value);
  const curT = Number($target.value);
  for(const b of boundsOpts) for(const s of stOpts) for(const e of enOpts) for(const tk of termOpts){
    const r = simulateOnce({ arr:curArr, t:curT, bounds:b, ltUpdateSt:s, gtUpdateEn:e, terminateToken:tk });
    res.push({ bounds:b, stRule:s, enRule:e, term:tk, ...r });
  }
  $comboBody.innerHTML="";
  for(const r of res){
    const tr = document.createElement("tr");
    const termText = r.term==="st_ge_en" ? "st ≥ en" : "st > en";
    let resultCell="";
    if(r.status==="ok"){
      resultCell = r.found
        ? `<span class="badge badge-ok">OK (idx=${r.idx})</span>`
        : `<span class="badge badge-ins">OK (삽입점=${r.idx})</span>`;
    }else if(r.status==="loop"){
      resultCell = `<span class="badge badge-loop">LOOP</span>`;
    }else{
      resultCell = `<span class="badge badge-err">ERROR</span>`;
    }
    tr.innerHTML = `
      <td>${r.bounds}</td>
      <td>st = ${r.stRule}</td>
      <td>en = ${r.enRule}</td>
      <td>${termText}</td>
      <td>${resultCell}</td>
    `;
    $comboBody.appendChild(tr);
  }
  $comboWrap.style.display="block";
}

const testCases = [
  { name:"A) lower_bound safe",
    cfg:{ bounds:"0..n", ltUpdateSt:"mid+1", gtUpdateEn:"mid", terminateToken:"st_ge_en"},
    arr:[1,2,3,5,5,7,9,12,12,13,17], t:12, expect:{status:"ok", found:true} },
  { name:"B) find_any safe",
    cfg:{ bounds:"0..n-1", ltUpdateSt:"mid+1", gtUpdateEn:"mid-1", terminateToken:"st_gt_en"},
    arr:[1,2,3,5,5,7,9,12,12,13,17], t:12, expect:{status:"ok", found:true} },
  { name:"C) no element → insertion point",
    cfg:{ bounds:"0..n", ltUpdateSt:"mid+1", gtUpdateEn:"mid", terminateToken:"st_ge_en"},
    arr:[1,3,4,10], t:5, expect:{status:"ok", found:false, idx:2} },
  { name:"D) loop danger ([0,n), st=mid, en=mid)",
    cfg:{ bounds:"0..n", ltUpdateSt:"mid", gtUpdateEn:"mid", terminateToken:"st_ge_en"},
    arr:[1,2,3], t:4, expect:{status:"loop"} },
  { name:"E) invariant break (use en=mid-1 on [0,n))",
    cfg:{ bounds:"0..n", ltUpdateSt:"mid+1", gtUpdateEn:"mid-1", terminateToken:"st_ge_en"},
    arr:[1,3], t:2, expect:{status:"error"} },
  { name:"F) empty array [0,n): insertion=0",
    cfg:{ bounds:"0..n", ltUpdateSt:"mid+1", gtUpdateEn:"mid", terminateToken:"st_ge_en"},
    arr:[], t:10, expect:{status:"ok", found:false, idx:0} },
  { name:"G) insertion at end",
    cfg:{ bounds:"0..n", ltUpdateSt:"mid+1", gtUpdateEn:"mid", terminateToken:"st_ge_en"},
    arr:[1,3,5], t:9, expect:{status:"ok", found:false, idx:3} },
  { name:"H) closed interval not found → -1",
    cfg:{ bounds:"0..n-1", ltUpdateSt:"mid+1", gtUpdateEn:"mid-1", terminateToken:"st_gt_en"},
    arr:[2,4,6], t:5, expect:{status:"ok", found:false, idx:-1} },
];

function runTests(){
  $testsBody.innerHTML="";
  const results = testCases.map(tc=>{
    const r = simulateOnce({ arr:tc.arr, t:tc.t, ...tc.cfg });
    const pass = Object.keys(tc.expect).every(k => r[k]===tc.expect[k]);
    return { name:tc.name, pass, got:r, expect:tc.expect };
  });
  for(const r of results){
    const row = document.createElement("div");
    row.className="row";
    const icon = document.createElement("div");
    icon.innerHTML = r.pass ? "✅" : "❌";
    icon.className = r.pass ? "ok" : "fail";
    const name = document.createElement("div");
    name.style.flex = "1";
    name.innerHTML = `<b>${r.name}</b>`;
    const detail = document.createElement("div");
    detail.style.color = "var(--fg-dim)";
    detail.style.fontSize = "11px";
    detail.textContent = `expect ${JSON.stringify(r.expect)} · got ${JSON.stringify(r.got)}`;
    row.appendChild(icon); row.appendChild(name); row.appendChild(detail);
    $testsBody.appendChild(row);
  }
  $testsWrap.style.display="block";
}

/* =============================
 * Events & Wiring
 * ===========================*/
function onAnyConfigChange(){
  arr = parseArray($arrayText.value);
  t = Number($target.value);
  bounds = $bounds.value;
  ltUpdateSt = $lt.value;
  gtUpdateEn = $gt.value;
  terminateToken = $term.value;
  resetAll();
}
$bounds.addEventListener("change", onAnyConfigChange);
$lt.addEventListener("change", onAnyConfigChange);
$gt.addEventListener("change", onAnyConfigChange);
$term.addEventListener("change", onAnyConfigChange);
$arrayText.addEventListener("input", onAnyConfigChange);
$target.addEventListener("input", onAnyConfigChange);

$btnReset.addEventListener("click", resetAll);
$btnStep.addEventListener("click", ()=>{ if(foundIndex===null && !diag.error) stepOnce(); });
$btnAuto.addEventListener("click", ()=>{
  if(foundIndex!==null || diag.error) return;
  autorun = !autorun;
  if(autorun){ startTimer(); $btnAuto.textContent="⏸ 일시정지"; $btnAuto.classList.add("btn-danger"); }
  else { clearTimer(); $btnAuto.textContent="⏯ 자동 실행"; $btnAuto.classList.add("btn-danger"); }
});

$btnCombos.addEventListener("click", runAll16);
$btnTests.addEventListener("click", runTests);

/* init */
resetAll();
renderAll();
</script>
</body>
</html>
